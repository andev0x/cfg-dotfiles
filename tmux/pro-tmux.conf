
### ========================
### GENERAL SETTINGS
### ANVNDEV
### TMUX CONFIGURATION PRO
### ========================

set -g mouse on
set -g history-limit 100000
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set-option -g focus-events on

# True color support
set -g default-terminal "tmux-256color"
set -as terminal-overrides ",xterm-256color:Tc"

# Use Vi-style keys in copy mode
setw -g mode-keys vi


### ========================
### 2. SMART NAVIGATION (Vim + Tmux)
### ========================

# Seamless navigation between Tmux panes and Neovim splits using Alt + hjkl
# Note: Requires 'christoomey/vim-tmux-navigator' plugin in Neovim
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|l?n?vim?x?|fzf)(diff)?$'"

bind-key -n 'M-h' if-shell "$is_vim" 'send-keys M-h' 'select-pane -L'
bind-key -n 'M-j' if-shell "$is_vim" 'send-keys M-j' 'select-pane -D'
bind-key -n 'M-k' if-shell "$is_vim" 'send-keys M-k' 'select-pane -U'
bind-key -n 'M-l' if-shell "$is_vim" 'send-keys M-l' 'select-pane -R'

# Resize panes (Alt + Shift + hjkl)
bind -n M-H resize-pane -L 5
bind -n M-L resize-pane -R 5
bind -n M-J resize-pane -D 2
bind -n M-K resize-pane -U 2


### ========================
### 3. FLOATING TERMINAL (Popup)
### ========================

# Toggle a floating terminal popup with Alt + f
bind -n M-f display-popup -E -w 80% -h 80% -d "#{pane_current_path}" "zsh"


### ========================
### 4. COMPACT STATUS BAR
### ========================

set -g status-position bottom
set -g status-interval 5
set -g status-justify left
set -g status-style bg=default,fg=white

# Colors: Green: #a6e3a1, Blue: #89b4fa, Peach: #fab387, Surface: #313244, Text: #cdd6f4

# Left side: Session [Icon | Name]
set -g status-left-length 30
set -g status-left "#[fg=#a6e3a1,bg=default]#[fg=#1e1e2e,bg=#a6e3a1,bold]#[fg=#a6e3a1,bg=#313244]#[fg=#cdd6f4,bg=#313244] #S #[fg=#313244,bg=default] "

# Window List Styling
setw -g window-status-separator ""

# Inactive Window: [Index Icon | Name]
setw -g window-status-format "#[fg=#89b4fa,bg=default] #[fg=#1e1e2e,bg=#89b4fa]#I#[fg=#89b4fa,bg=#313244]#[fg=#cdd6f4,bg=#313244] #W #[fg=#313244,bg=default]"

# Active Window: [Index Icon | Name]
setw -g window-status-current-format "#[fg=#fab387,bg=default] #[fg=#1e1e2e,bg=#fab387]#I#[fg=#fab387,bg=#313244]#[fg=#cdd6f4,bg=#313244,bold] #W #[fg=#313244,bg=default]"

# Right side: [Icon (Colored) | Data (Dark)]
set -g status-right-length 150
set -g status-right "#[fg=#f9e2af,bg=default]#[fg=#1e1e2e,bg=#f9e2af]#[fg=#f9e2af,bg=#313244]#[fg=#cdd6f4,bg=#313244] #(if git -C #{pane_current_path} rev-parse --is-inside-work-tree >/dev/null 2>&1; then git -C #{pane_current_path} rev-parse --abbrev-ref HEAD; else basename #{pane_current_path}; fi) #[fg=#313244,bg=default] \
#[fg=#94e2d5,bg=default]#[fg=#1e1e2e,bg=#94e2d5]#[fg=#94e2d5,bg=#313244]#[fg=#cdd6f4,bg=#313244] #{cpu_percentage} #[fg=#313244,bg=default] \
#[fg=#f5c2e7,bg=default]#[fg=#1e1e2e,bg=#f5c2e7]#[fg=#f5c2e7,bg=#313244]#[fg=#cdd6f4,bg=#313244] #(whoami) #[fg=#313244,bg=default] \
#[fg=#a6e3a1,bg=default]#[fg=#1e1e2e,bg=#a6e3a1]󱛡#[fg=#a6e3a1,bg=#313244]#[fg=#cdd6f4,bg=#313244] %H:%M #[fg=#313244,bg=default]"


### ========================
### 5. PANE VISUALS & BORDERS
### ========================

# Dim inactive panes for better focus
set -g window-style 'fg=#626880,bg=default'
set -g window-active-style 'fg=#cdd6f4,bg=default'

# Pane border styling
set -g pane-border-style "fg=#313244"
set -g pane-active-border-style "fg=#89b4fa"

# Command line / Message styling
set -g message-style "fg=#fab387,bg=#313244,bold"


### ========================
### 6. KEYBINDINGS & CLIPBOARD
### ========================

# Split panes with current path
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Reload config
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Kill commands
bind x kill-pane
bind X kill-window
bind Q kill-session

# Copy selection to macOS clipboard
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"


### ========================
### 7. PLUGINS (TPM)
### ========================

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'sainnhe/tmux-fzf'

set -g @continuum-restore 'on'
set -g @resurrect-strategy-nvim 'session'

# Initialize TPM (must be last)
run '~/.tmux/plugins/tpm/tpm'
